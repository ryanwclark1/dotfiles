#!/usr/bin/env bash

# Pre-commit hook for dotfiles repository
# Runs tests before allowing commit

set -e

echo "üîç Running pre-commit checks..."
echo ""

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Get repository root
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

# Check if tests exist
if [[ ! -f "$REPO_ROOT/run-tests.sh" ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è  Warning: run-tests.sh not found, skipping tests${NC}"
    exit 0
fi

# Run tests (excluding MCP tests which require external dependencies)
echo "Running test suites..."
if ./run-tests.sh bootstrap configs scripts; then
    echo ""
    echo -e "${GREEN}‚úÖ All tests passed! Proceeding with commit.${NC}"
    exit 0
else
    echo ""
    echo -e "${RED}‚ùå Tests failed! Please fix the issues before committing.${NC}"
    echo ""
    echo "To bypass this check (not recommended), use:"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi
